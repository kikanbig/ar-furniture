<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéâ AR Working Final | –†–ê–ë–û–ß–ê–Ø –í–ï–†–°–ò–Ø!</title>
    <meta http-equiv="cache-control" content="no-cache, no-store, must-revalidate">
    
    <!-- WebXR Polyfill -->
    <script src="https://cdn.jsdelivr.net/npm/webxr-polyfill@latest/build/webxr-polyfill.min.js"></script>
    
    <!-- Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #000;
            color: white;
            margin: 0;
            padding: 20px;
        }
        
        .start-btn {
            background: linear-gradient(45deg, #4CAF50, #8BC34A);
            color: white;
            border: none;
            padding: 20px 40px;
            font-size: 18px;
            font-weight: bold;
            border-radius: 15px;
            cursor: pointer;
            width: 100%;
            margin: 15px 0;
            box-shadow: 0 8px 20px rgba(76, 175, 80, 0.3);
        }
        
        .log {
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 15px;
            border-radius: 10px;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            margin: 10px 0;
            border: 2px solid #4CAF50;
            position: relative;
            z-index: 9999;
        }
        
        .hidden { display: none; }
        
        .controls {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            z-index: 9999;
            justify-content: center;
        }
        
        .btn {
            padding: 12px 18px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            color: white;
            background: linear-gradient(45deg, #4CAF50, #8BC34A);
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
        }
        
        .btn:active {
            transform: translateY(2px);
        }
        
        .success {
            background: linear-gradient(135deg, #4CAF50 0%, #8BC34A 100%);
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            text-align: center;
            border: 2px solid #4CAF50;
        }
        
        .instructions {
            background: rgba(76, 175, 80, 0.1);
            border: 1px solid #4CAF50;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>üéâ AR Working Final</h1>
    
    <div class="success">
        <h2>‚úÖ –ü–†–û–ë–õ–ï–ú–ê –†–ï–®–ï–ù–ê!</h2>
        <p>–û—Å–Ω–æ–≤–∞–Ω–æ –Ω–∞ –†–ê–ë–û–¢–ê–Æ–©–ï–ú Debug Spaces —Ç–µ—Å—Ç–µ</p>
        <p>–ò—Å–ø–æ–ª—å–∑—É–µ—Ç <strong>–ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—É—é –∫–æ–º–±–∏–Ω–∞—Ü–∏—é</strong> –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –∏ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</p>
    </div>
    
    <button id="start-btn" class="start-btn">
        üéâ –ó–ê–ü–£–°–¢–ò–¢–¨ –†–ê–ë–û–ß–£–Æ –í–ï–†–°–ò–Æ
    </button>
    
    <div id="log" class="log">
        üìù Working Final –≥–æ—Ç–æ–≤...<br>
        ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –î–û–ö–ê–ó–ê–ù–ù–û –†–ê–ë–û–¢–ê–Æ–©–ò–ô –ø–æ–¥—Ö–æ–¥<br>
    </div>
    
    <div class="instructions">
        <h3>üìã –ß—Ç–æ –≤—ã —É–≤–∏–¥–∏—Ç–µ:</h3>
        <ul>
            <li>ü™ë <strong>–ö—Ä–µ—Å–ª–æ</strong> –∏–∑ chair-modern.glb</li>
            <li>üî¥ <strong>–ö—Ä–∞—Å–Ω—ã–π –∫—É–±</strong> (viewer space)</li>
            <li>üü¢ <strong>–ó–µ–ª–µ–Ω—ã–π –∫—É–±</strong> (local space)</li>
            <li>üîµ <strong>–°–∏–Ω–∏–π –∫—É–±</strong> (local-floor space)</li>
            <li>üü° <strong>–ñ–µ–ª—Ç—ã–π –∫—É–±</strong> (unbounded space)</li>
            <li>‚ö™ <strong>–ë–µ–ª—ã–π –∫—É–±</strong> (origin)</li>
            <li>üîµ <strong>–ì–æ–ª—É–±–∞—è —Å—Ñ–µ—Ä–∞</strong> (–≤—ã—Å–æ–∫–æ)</li>
        </ul>
        <p><strong>–í—Å–µ –æ–±—ä–µ–∫—Ç—ã –∞–Ω–∏–º–∏—Ä—É—é—Ç—Å—è –∏ —Å–≤–µ—Ç—è—Ç—Å—è!</strong></p>
    </div>
    
    <div id="controls" class="controls hidden">
        <button id="add-chair" class="btn">ü™ë –î–û–ë–ê–í–ò–¢–¨ –ö–†–ï–°–õ–û</button>
        <button id="add-cube" class="btn">üì¶ –î–û–ë–ê–í–ò–¢–¨ –ö–£–ë</button>
        <button id="toggle-animation" class="btn">üé¨ –ê–ù–ò–ú–ê–¶–ò–Ø</button>
        <button id="clear-all" class="btn">üóëÔ∏è –û–ß–ò–°–¢–ò–¢–¨</button>
        <button id="exit-btn" class="btn">‚ùå –í–´–•–û–î</button>
    </div>

    <script>
        let session = null;
        let renderer = null;
        let scene = null;
        let camera = null;
        let referenceSpaces = {};
        let frameCount = 0;
        let objects = [];
        let chairTemplate = null;
        let animationEnabled = true;
        
        const log = document.getElementById('log');
        const controls = document.getElementById('controls');

        function addLog(message) {
            console.log(message);
            log.innerHTML += message + '<br>';
            log.scrollTop = log.scrollHeight;
        }

        async function startWorkingFinal() {
            const startBtn = document.getElementById('start-btn');
            startBtn.disabled = true;
            startBtn.innerHTML = 'üîÑ –ó–∞–ø—É—Å–∫ —Ä–∞–±–æ—á–µ–π –≤–µ—Ä—Å–∏–∏...';
            
            try {
                addLog('üéâ === WORKING FINAL AR ===');
                addLog('‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ–º –ü–†–û–í–ï–†–ï–ù–ù–´–ô –ø–æ–¥—Ö–æ–¥ –∏–∑ Debug Spaces');
                
                // WebXR Polyfill
                if (window.WebXRPolyfill && !navigator.xr) {
                    const polyfill = new WebXRPolyfill();
                    addLog('üîß WebXR Polyfill –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω');
                }
                
                if (!navigator.xr) {
                    throw new Error('WebXR –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
                }
                
                // –°–æ–∑–¥–∞–Ω–∏–µ AR —Å–µ—Å—Å–∏–∏
                session = await navigator.xr.requestSession('immersive-ar', {
                    requiredFeatures: ['local'],
                    optionalFeatures: ['local-floor', 'unbounded']
                });
                
                addLog('‚úÖ AR —Å–µ—Å—Å–∏—è —Å–æ–∑–¥–∞–Ω–∞');
                
                // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ reference spaces
                await setupReferenceSpaces();
                
                // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–µ–Ω–¥–µ—Ä–µ—Ä–∞ (–∫–æ–ø–∏—Ä—É–µ–º –∏–∑ Debug Spaces)
                await setupRenderer();
                setupScene();
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫—Ä–µ—Å–ª–æ
                await loadChair();
                
                // –°–æ–∑–¥–∞–µ–º –†–ê–ë–û–¢–ê–Æ–©–ò–ï –æ–±—ä–µ–∫—Ç—ã (–∏–∑ Debug Spaces)
                createWorkingObjects();
                
                // –ó–∞–ø—É—Å–∫
                session.requestAnimationFrame(onXRFrame);
                
                startBtn.innerHTML = '‚úÖ WORKING FINAL –ê–ö–¢–ò–í–ï–ù';
                controls.classList.remove('hidden');
                
                setupControls();
                
                addLog('üéâ Working Final –∑–∞–ø—É—â–µ–Ω!');
                addLog('üëÄ –ò—â–∏—Ç–µ –∫—Ä–µ—Å–ª–æ –∏ —Ü–≤–µ—Ç–Ω—ã–µ –∫—É–±—ã!');
                
            } catch (error) {
                addLog('‚ùå –û–®–ò–ë–ö–ê: ' + error.message);
                startBtn.disabled = false;
                startBtn.innerHTML = 'üéâ –ó–ê–ü–£–°–¢–ò–¢–¨ –†–ê–ë–û–ß–£–Æ –í–ï–†–°–ò–Æ';
            }
        }

        async function setupReferenceSpaces() {
            addLog('üîç === –ù–ê–°–¢–†–û–ô–ö–ê REFERENCE SPACES ===');
            
            const spacesToTest = ['viewer', 'local', 'local-floor', 'unbounded'];
            
            for (const spaceName of spacesToTest) {
                try {
                    const space = await session.requestReferenceSpace(spaceName);
                    referenceSpaces[spaceName] = space;
                    addLog(`‚úÖ ${spaceName} space - –¥–æ—Å—Ç—É–ø–µ–Ω`);
                } catch (error) {
                    addLog(`‚ùå ${spaceName} space - –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω`);
                }
            }
            
            addLog(`üìä –î–æ—Å—Ç—É–ø–Ω–æ spaces: ${Object.keys(referenceSpaces).length}`);
        }

        async function setupRenderer() {
            addLog('üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–µ–Ω–¥–µ—Ä–µ—Ä–∞...');
            
            const canvas = document.createElement('canvas');
            const gl = canvas.getContext('webgl', { xrCompatible: true });
            
            renderer = new THREE.WebGLRenderer({
                canvas: canvas,
                context: gl,
                alpha: true,
                antialias: true
            });
            
            renderer.xr.enabled = true;
            renderer.xr.setSession(session);
            renderer.setPixelRatio(window.devicePixelRatio);
            
            const baseLayer = new XRWebGLLayer(session, gl);
            await session.updateRenderState({ baseLayer: baseLayer });
            
            addLog('‚úÖ –†–µ–Ω–¥–µ—Ä–µ—Ä –≥–æ—Ç–æ–≤');
        }

        function setupScene() {
            addLog('üé® –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ü–µ–Ω—ã...');
            
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera();
            
            // –ú–ê–ö–°–ò–ú–ê–õ–¨–ù–û–ï –æ—Å–≤–µ—â–µ–Ω–∏–µ (–∏–∑ Debug Spaces)
            const ambientLight = new THREE.AmbientLight(0xffffff, 5.0);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 3.0);
            directionalLight.position.set(1, 1, 1);
            scene.add(directionalLight);
            
            addLog('‚úÖ –°—Ü–µ–Ω–∞ –≥–æ—Ç–æ–≤–∞');
        }

        async function loadChair() {
            return new Promise((resolve) => {
                const loader = new THREE.GLTFLoader();
                
                addLog('ü™ë –ó–∞–≥—Ä—É–∑–∫–∞ –∫—Ä–µ—Å–ª–∞ chair-modern.glb...');
                
                loader.load(
                    '/models/chair-modern.glb',
                    function(gltf) {
                        chairTemplate = gltf.scene.clone();
                        chairTemplate.scale.set(0.3, 0.3, 0.3);
                        
                        // –ü—Ä–∏–º–µ–Ω—è–µ–º –†–ê–ë–û–¢–ê–Æ–©–ò–ï –º–∞—Ç–µ—Ä–∏–∞–ª—ã
                        chairTemplate.traverse(function(child) {
                            if (child.isMesh) {
                                // –ó–∞–º–µ–Ω—è–µ–º –º–∞—Ç–µ—Ä–∏–∞–ª –Ω–∞ MeshBasicMaterial —Å emissive
                                child.material = new THREE.MeshBasicMaterial({
                                    color: 0x8B4513, // –ö–æ—Ä–∏—á–Ω–µ–≤—ã–π —Ü–≤–µ—Ç –∫—Ä–µ—Å–ª–∞
                                    emissive: 0x332211, // –ö–æ—Ä–∏—á–Ω–µ–≤–æ–µ —Å–≤–µ—á–µ–Ω–∏–µ
                                    emissiveIntensity: 0.3
                                });
                            }
                        });
                        
                        addLog('‚úÖ –ö—Ä–µ—Å–ª–æ chair-modern.glb –∑–∞–≥—Ä—É–∂–µ–Ω–æ –∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ!');
                        resolve();
                    },
                    function(progress) {
                        const percent = Math.round((progress.loaded / progress.total) * 100);
                        if (percent % 25 === 0) {
                            addLog('ü™ë –ó–∞–≥—Ä—É–∑–∫–∞ –∫—Ä–µ—Å–ª–∞: ' + percent + '%');
                        }
                    },
                    function(error) {
                        addLog('‚ö†Ô∏è –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ GLB, —Å–æ–∑–¥–∞–µ–º –ø—Ä–æ—Å—Ç–æ–µ –∫—Ä–µ—Å–ª–æ');
                        createFallbackChair();
                        resolve();
                    }
                );
            });
        }

        function createFallbackChair() {
            const group = new THREE.Group();
            
            // –Ø–†–ö–û–ï –°–ò–î–ï–ù–¨–ï —Å emissive –º–∞—Ç–µ—Ä–∏–∞–ª–æ–º
            const seatGeometry = new THREE.BoxGeometry(0.8, 0.1, 0.8);
            const seatMaterial = new THREE.MeshBasicMaterial({ 
                color: 0x8B4513,
                emissive: 0x332211,
                emissiveIntensity: 0.3
            });
            const seat = new THREE.Mesh(seatGeometry, seatMaterial);
            seat.position.y = 0.4;
            group.add(seat);
            
            // –Ø–†–ö–ê–Ø –°–ü–ò–ù–ö–ê
            const backGeometry = new THREE.BoxGeometry(0.8, 0.8, 0.1);
            const backMaterial = new THREE.MeshBasicMaterial({ 
                color: 0x8B4513,
                emissive: 0x332211,
                emissiveIntensity: 0.3
            });
            const back = new THREE.Mesh(backGeometry, backMaterial);
            back.position.set(0, 0.8, -0.35);
            group.add(back);
            
            // –ù–û–ñ–ö–ò
            const legGeometry = new THREE.CylinderGeometry(0.03, 0.03, 0.4);
            const legMaterial = new THREE.MeshBasicMaterial({ 
                color: 0x8B4513,
                emissive: 0x221100,
                emissiveIntensity: 0.2
            });
            
            const legPositions = [
                [-0.3, 0.2, -0.3], [0.3, 0.2, -0.3], 
                [-0.3, 0.2, 0.3], [0.3, 0.2, 0.3]
            ];
            
            legPositions.forEach(function(pos) {
                const leg = new THREE.Mesh(legGeometry, legMaterial);
                leg.position.set(pos[0], pos[1], pos[2]);
                group.add(leg);
            });
            
            chairTemplate = group;
            addLog('üîß –ü—Ä–æ—Å—Ç–æ–µ –∫—Ä–µ—Å–ª–æ —Å–æ–∑–¥–∞–Ω–æ —Å emissive –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º–∏');
        }

        function createWorkingObjects() {
            addLog('üì¶ === –°–û–ó–î–ê–ù–ò–ï –†–ê–ë–û–¢–ê–Æ–©–ò–• –û–ë–™–ï–ö–¢–û–í ===');
            addLog('‚úÖ –ö–æ–ø–∏—Ä—É–µ–º –¢–û–ß–ù–£–Æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏–∑ Debug Spaces');
            
            const colors = [0xFF0000, 0x00FF00, 0x0000FF, 0xFFFF00];
            let colorIndex = 0;
            
            // –û–±—ä–µ–∫—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ reference space (–ö–ê–ö –í DEBUG SPACES!)
            for (const [spaceName, space] of Object.entries(referenceSpaces)) {
                const color = colors[colorIndex % colors.length];
                
                const geometry = new THREE.BoxGeometry(0.5, 0.5, 0.5);
                const material = new THREE.MeshBasicMaterial({ 
                    color: color,
                    emissive: color,
                    emissiveIntensity: 0.3
                });
                const cube = new THREE.Mesh(geometry, material);
                
                // –¢–û–ß–ù–´–ï –ø–æ–∑–∏—Ü–∏–∏ –∏–∑ Debug Spaces
                let position;
                switch (spaceName) {
                    case 'viewer':
                        position = new THREE.Vector3(0, 0, -0.5);
                        break;
                    case 'local':
                        position = new THREE.Vector3(0, 0, -1);
                        break;
                    case 'local-floor':
                        position = new THREE.Vector3(0, 0.5, -1);
                        break;
                    case 'unbounded':
                        position = new THREE.Vector3(0, 0, -1.2);
                        break;
                    default:
                        position = new THREE.Vector3(0, 0, -1);
                }
                
                cube.position.copy(position);
                scene.add(cube);
                
                objects.push({
                    object: cube,
                    spaceName: spaceName,
                    color: `#${color.toString(16).padStart(6, '0')}`,
                    type: 'space-cube'
                });
                
                addLog(`‚úÖ ${spaceName}: –∫—É–± ${objects[objects.length-1].color}`);
                colorIndex++;
            }
            
            // –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –û–ë–™–ï–ö–¢–´ (–ö–ê–ö –í DEBUG SPACES!)
            
            // 1. –û–≥—Ä–æ–º–Ω—ã–π –±–µ–ª—ã–π –∫—É–± –≤ origin
            const hugeCube = new THREE.Mesh(
                new THREE.BoxGeometry(2, 2, 2),
                new THREE.MeshBasicMaterial({ 
                    color: 0xFFFFFF, 
                    emissive: 0x333333,
                    emissiveIntensity: 0.2
                })
            );
            hugeCube.position.set(0, 0, 0);
            scene.add(hugeCube);
            objects.push({
                object: hugeCube,
                type: 'origin-cube',
                color: '#ffffff'
            });
            addLog('‚úÖ –û–≥—Ä–æ–º–Ω—ã–π –±–µ–ª—ã–π –∫—É–± –≤ origin');
            
            // 2. –°–≤–µ—Ç—è—â–∞—è—Å—è –≥–æ–ª—É–±–∞—è —Å—Ñ–µ—Ä–∞
            const sphere = new THREE.Mesh(
                new THREE.SphereGeometry(0.3, 16, 16),
                new THREE.MeshBasicMaterial({ 
                    color: 0x00FFFF, 
                    emissive: 0x00FFFF,
                    emissiveIntensity: 0.8
                })
            );
            sphere.position.set(0, 1, -0.5);
            scene.add(sphere);
            objects.push({
                object: sphere,
                type: 'glow-sphere',
                color: '#00ffff'
            });
            addLog('‚úÖ –°–≤–µ—Ç—è—â–∞—è—Å—è –≥–æ–ª—É–±–∞—è —Å—Ñ–µ—Ä–∞');
            
            // 3. –ö–†–ï–°–õ–û –Ω–∞ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏
            if (chairTemplate) {
                const chair = chairTemplate.clone();
                chair.position.set(1, -0.3, -1); // –°–ø—Ä–∞–≤–∞ –æ—Ç —Ü–µ–Ω—Ç—Ä–∞, –Ω–µ–º–Ω–æ–≥–æ –Ω–∏–∂–µ
                scene.add(chair);
                objects.push({
                    object: chair,
                    type: 'chair',
                    color: '#8b4513'
                });
                addLog('‚úÖ –ö—Ä–µ—Å–ª–æ —Ä–∞–∑–º–µ—â–µ–Ω–æ —Å–ø—Ä–∞–≤–∞ –æ—Ç —Ü–µ–Ω—Ç—Ä–∞');
            }
            
            addLog(`üìä –ò–¢–û–ì–û –æ–±—ä–µ–∫—Ç–æ–≤: ${objects.length}`);
            addLog('üéØ –í—Å–µ –æ–±—ä–µ–∫—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç MeshBasicMaterial + emissive!');
        }

        function onXRFrame(time, frame) {
            session.requestAnimationFrame(onXRFrame);
            frameCount++;
            
            // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–∂–¥—ã–µ 60 –∫–∞–¥—Ä–æ–≤
            if (frameCount % 60 === 0) {
                addLog(`üîÑ Frame ${frameCount} - —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ ${objects.length} –æ–±—ä–µ–∫—Ç–æ–≤`);
                
                if (frameCount === 60) {
                    addLog('üëÄ –ò–©–ò–¢–ï:');
                    objects.forEach((item, index) => {
                        if (item.object && item.object.position) {
                            const pos = item.object.position;
                            addLog(`  ${item.color} ${item.type}: (${pos.x.toFixed(1)}, ${pos.y.toFixed(1)}, ${pos.z.toFixed(1)})`);
                        }
                    });
                }
            }
            
            // –ê–ù–ò–ú–ê–¶–ò–Ø –¥–ª—è –∑–∞–º–µ—Ç–Ω–æ—Å—Ç–∏ (–∫–∞–∫ –≤ Debug Spaces)
            if (animationEnabled) {
                const rotationSpeed = time * 0.001;
                objects.forEach((item, index) => {
                    if (item.object && item.object.rotation) {
                        item.object.rotation.x = rotationSpeed * (index + 1);
                        item.object.rotation.y = rotationSpeed * (index + 1) * 1.5;
                        item.object.rotation.z = rotationSpeed * (index + 1) * 0.5;
                    }
                });
                
                // –ü—É–ª—å—Å–∞—Ü–∏—è –¥–ª—è —Å–≤–µ—Ç—è—â–µ–π—Å—è —Å—Ñ–µ—Ä—ã
                const glowSphere = objects.find(item => item.type === 'glow-sphere');
                if (glowSphere && glowSphere.object.scale) {
                    const pulse = 1 + Math.sin(time * 0.003) * 0.3;
                    glowSphere.object.scale.set(pulse, pulse, pulse);
                }
            }
            
            try {
                renderer.render(scene, camera);
            } catch (error) {
                if (frameCount < 5) {
                    addLog('‚ùå –û–®–ò–ë–ö–ê –†–ï–ù–î–ï–†–ò–ù–ì–ê: ' + error.message);
                }
            }
        }

        function addChair() {
            if (!chairTemplate) {
                addLog('‚ö†Ô∏è –ö—Ä–µ—Å–ª–æ –µ—â–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ');
                return;
            }
            
            const chair = chairTemplate.clone();
            chair.position.set(
                (Math.random() - 0.5) * 4,  // -2 –¥–æ 2
                Math.random() * 0.5 - 0.5,  // -0.5 –¥–æ 0
                -0.5 - Math.random() * 2    // –æ—Ç -0.5 –¥–æ -2.5
            );
            
            scene.add(chair);
            objects.push({
                object: chair,
                type: 'chair-added',
                color: '#8b4513'
            });
            
            addLog(`ü™ë –ö—Ä–µ—Å–ª–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ: (${chair.position.x.toFixed(2)}, ${chair.position.y.toFixed(2)}, ${chair.position.z.toFixed(2)})`);
        }

        function addRandomCube() {
            const colors = [0xFF0000, 0x00FF00, 0x0000FF, 0xFFFF00, 0xFF00FF, 0x00FFFF];
            const color = colors[Math.floor(Math.random() * colors.length)];
            
            const cube = new THREE.Mesh(
                new THREE.BoxGeometry(0.3, 0.3, 0.3),
                new THREE.MeshBasicMaterial({ 
                    color: color,
                    emissive: color,
                    emissiveIntensity: 0.4
                })
            );
            
            cube.position.set(
                (Math.random() - 0.5) * 3,
                (Math.random() - 0.5) * 2,
                -0.3 - Math.random() * 2
            );
            
            scene.add(cube);
            objects.push({
                object: cube,
                type: 'random-cube',
                color: `#${color.toString(16).padStart(6, '0')}`
            });
            
            addLog(`üì¶ –°–ª—É—á–∞–π–Ω—ã–π –∫—É–± ${objects[objects.length-1].color} –¥–æ–±–∞–≤–ª–µ–Ω`);
        }

        function toggleAnimation() {
            animationEnabled = !animationEnabled;
            addLog(`üé¨ –ê–Ω–∏–º–∞—Ü–∏—è: ${animationEnabled ? '–í–ö–õ–Æ–ß–ï–ù–ê' : '–í–´–ö–õ–Æ–ß–ï–ù–ê'}`);
        }

        function clearAllObjects() {
            // –£–¥–∞–ª—è–µ–º —Ç–æ–ª—å–∫–æ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã, –æ—Å—Ç–∞–≤–ª—è–µ–º –±–∞–∑–æ–≤—ã–µ
            const toRemove = objects.filter(item => 
                item.type === 'chair-added' || item.type === 'random-cube'
            );
            
            toRemove.forEach(item => {
                if (item.object.parent) {
                    item.object.parent.remove(item.object);
                }
            });
            
            objects = objects.filter(item => 
                item.type !== 'chair-added' && item.type !== 'random-cube'
            );
            
            addLog(`üóëÔ∏è –£–¥–∞–ª–µ–Ω–æ –æ–±—ä–µ–∫—Ç–æ–≤: ${toRemove.length}, –æ—Å—Ç–∞–ª–æ—Å—å: ${objects.length}`);
        }

        function setupControls() {
            document.getElementById('add-chair').addEventListener('click', addChair);
            document.getElementById('add-cube').addEventListener('click', addRandomCube);
            document.getElementById('toggle-animation').addEventListener('click', toggleAnimation);
            document.getElementById('clear-all').addEventListener('click', clearAllObjects);
            
            document.getElementById('exit-btn').addEventListener('click', function() {
                session.end();
            });

            session.addEventListener('end', function() {
                addLog('üîö AR —Å–µ—Å—Å–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
                location.reload();
            });
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('start-btn').addEventListener('click', startWorkingFinal);
            addLog('üéâ Working Final –≥–æ—Ç–æ–≤ –∫ –∑–∞–ø—É—Å–∫—É');
            addLog('‚úÖ –û—Å–Ω–æ–≤–∞–Ω –Ω–∞ –ü–†–û–í–ï–†–ï–ù–ù–û –†–ê–ë–û–¢–ê–Æ–©–ï–ú Debug Spaces');
            addLog('ü™ë –í–∫–ª—é—á–∞–µ—Ç –∫—Ä–µ—Å–ª–æ + –≤—Å–µ —Ä–∞–±–æ—á–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã');
        });
    </script>
</body>
</html>